name: Multi-Platform Matrix Build

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  matrix-build:
    runs-on: ${{ matrix.os }}
    
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        node-version: [16, 18, 20]
        include:
          - os: ubuntu-latest
            platform: linux
          - os: macos-latest
            platform: macos
          - os: windows-latest
            platform: windows
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
      
      - name: matrix-cf47bfd
        run: |
          echo "Building for ${{ matrix.platform }} with Node.js ${{ matrix.node-version }}"
          echo "OS: ${{ matrix.os }}"
          echo "Timestamp: $(date)"
      
      - name: Install dependencies
        run: |
          npm init -y
          npm install uuid
      
      - name: Generate build artifact
        run: |
          node -e "console.log(JSON.stringify({
            platform: '${{ matrix.platform }}',
            os: '${{ matrix.os }}',
            nodeVersion: '${{ matrix.node-version }}',
            timestamp: new Date().toISOString(),
            buildId: require('crypto').randomBytes(8).toString('hex'),
            status: 'success'
          }, null, 2))" > build-output.json
      
      - name: Create additional build files
        run: |
          echo "Build completed successfully" > build.log
          echo "Platform: ${{ matrix.platform }}" >> build.log
          echo "Node Version: ${{ matrix.node-version }}" >> build.log
          echo "OS: ${{ matrix.os }}" >> build.log
      
      - name: Display build info
        run: |
          echo "=== Build Information ==="
          cat build-output.json
          echo ""
          echo "=== Build Log ==="
          cat build.log
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: build-cf47bfd-${{ matrix.platform }}-node${{ matrix.node-version }}
          path: |
            build-output.json
            build.log
          retention-days: 30
  
  python-matrix-build:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: ['3.9', '3.10', '3.11', '3.12']
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
      
      - name: matrix-cf47bfd
        run: |
          echo "Building Python project with version ${{ matrix.python-version }}"
          python --version
      
      - name: Generate Python build artifact
        run: |
          python -c "
import json
import datetime
import sys

build_info = {
    'language': 'python',
    'version': '${{ matrix.python-version }}',
    'timestamp': datetime.datetime.now().isoformat(),
    'python_full_version': sys.version,
    'status': 'success'
}

with open('python-build.json', 'w') as f:
    json.dump(build_info, f, indent=2)
          "
      
      - name: Create Python requirements file
        run: |
          echo "# Python ${{ matrix.python-version }} Build" > requirements.txt
          echo "requests>=2.31.0" >> requirements.txt
          echo "pytest>=7.4.0" >> requirements.txt
      
      - name: Display Python build info
        run: |
          echo "=== Python Build Information ==="
          cat python-build.json
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: build-cf47bfd-python${{ matrix.python-version }}
          path: |
            python-build.json
            requirements.txt
          retention-days: 30
  
  summary:
    needs: [matrix-build, python-matrix-build]
    runs-on: ubuntu-latest
    
    steps:
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: all-artifacts
      
      - name: Generate build summary
        run: |
          echo "# Multi-Platform Matrix Build Summary" > summary.md
          echo "" >> summary.md
          echo "## Build Artifacts Generated" >> summary.md
          echo "" >> summary.md
          ls -R all-artifacts >> summary.md
          echo "" >> summary.md
          echo "Build completed at: $(date)" >> summary.md
      
      - name: Display summary
        run: cat summary.md
      
      - name: Upload summary
        uses: actions/upload-artifact@v4
        with:
          name: build-cf47bfd-summary
          path: summary.md
          retention-days: 30
